<form [formGroup]="itemData" class="edit-box" novalidate (ngSubmit)="update()" >
  <button mat-icon-button
          class="loading-icon"
          type="button"
          disabled
          *ngIf="isLoading">
    <mat-icon>autorenew</mat-icon>
  </button>
  <button mat-icon-button
          class="more-btn"
          type="button"
          *ngIf="!isNew"
          [matMenuTriggerFor]="moreMenu">
    <mat-icon>more_horiz</mat-icon>
  </button>
  <mat-menu #moreMenu="matMenu" xPosition="before">
    <button mat-menu-item class="menu" (click)="delete()">删除</button>
  </mat-menu>
  <div>
    <div class="align-center icon">
      <mat-icon [inline]="true">book</mat-icon>
    </div>
    <mat-card-content>
      <div class="row">
        <div class="col">
          <mat-form-field class="full-width">
            <mat-select formControlName="list">
              <mat-option [value]="0">默认列表</mat-option>
              <mat-option *ngFor="let list of lists|async" [value]="list.id">{{list.title}}</mat-option>
            </mat-select>
          </mat-form-field>
        </div>
      </div>
      <div class="row">
        <div class="col">
          <mat-form-field class="full-width">
            <input matInput placeholder="标题" maxlength="255" formControlName="title" autocomplete="off">
          </mat-form-field>
        </div>
      </div>
      <div class="row">
        <div class="col">
          <mat-form-field class="full-width">
            <textarea matInput placeholder="描述" maxlength="1023" formControlName="info" autocomplete="off"></textarea>
          </mat-form-field>
        </div>
      </div>
      <div class="row">
        <div class="col">
          <mat-form-field class="full-width">
            <input matInput placeholder="图片" maxlength="1023" formControlName="img" autocomplete="off">
          </mat-form-field>
        </div>
      </div>
      <div class="row">
        <div class="col">
          <mat-form-field class="full-width">
            <input matInput placeholder="来源 URL" maxlength="1023" formControlName="url" autocomplete="off">
          </mat-form-field>
        </div>
      </div>
      <div *ngIf="item.images">
        <mat-card class="content-image-card" *ngFor="let image of item.images; index as i">
          <div #imageViewer class="content-image-viewer" (click)="imageEditor.hidden=!imageEditor.hidden;">
            <a (click)="$event.stopPropagation();" [href]="proxyService.proxy(image.url)" target="_blank" *ngIf="image.url">
              <div class="content-image" [style.background-image]="'url('+proxyService.proxy(image.url)+')'"></div>
            </a>
            <div class="content-image-text-box">
              <p class="content-image-text" *ngIf="image.url">{{image.url}}</p>
              <p class="content-image-text" *ngIf="image.info">{{image.info}}</p>
              <p class="content-image-text" *ngIf="!(image.url||image.info)">新建图片</p>
            </div>
          </div>
          <div #imageEditor class="content-image-editor" hidden>
            <div class="row">
              <div class="col">
                <mat-form-field class="full-width">
                  <input matInput placeholder="图片 URL" maxlength="1023" [(ngModel)]="image.url" [ngModelOptions]="{standalone: true}" autocomplete="off">
                </mat-form-field>
              </div>
            </div>
            <div class="row">
              <div class="col">
                <mat-form-field class="full-width">
                  <input matInput placeholder="描述" maxlength="1023" [(ngModel)]="image.info" [ngModelOptions]="{standalone: true}" autocomplete="off">
                </mat-form-field>
              </div>
            </div>
            <div class="align-center">
              <button mat-raised-button color="primary" type="button" (click)="item.images.splice(i, 1)">删除</button>
            </div>
          </div>
        </mat-card>
      </div>
      <div class="align-center">
        <button mat-icon-button type="button" (click)="addImage()">
          <mat-icon>add_photo_alternate</mat-icon>
        </button>
      </div>
    </mat-card-content>
    <div class="align-center">
      <button mat-raised-button color="primary" type="submit">保存</button>
    </div>
  </div>
</form>
