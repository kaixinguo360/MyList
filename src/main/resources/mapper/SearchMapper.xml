<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.my.list.service.search.SearchMapper">
  <resultMap id="BaseResultMap" type="com.my.list.domain.Node">
    <id column="id" jdbcType="BIGINT" property="id"/>
    <result column="node_user" jdbcType="BIGINT" property="user"/>
    <result column="node_type" jdbcType="VARCHAR" property="type"/>
    <result column="node_ctime" jdbcType="TIMESTAMP" property="ctime"/>
    <result column="node_mtime" jdbcType="TIMESTAMP" property="mtime"/>
    <result column="node_title" jdbcType="VARCHAR" property="title"/>
    <result column="node_excerpt" jdbcType="VARCHAR" property="excerpt"/>
    <result column="node_link_forward" jdbcType="INTEGER" property="linkForward"/>
    <result column="node_link_back" jdbcType="INTEGER" property="linkBack"/>
    <result column="node_link_delete" jdbcType="BIT" property="linkDelete"/>
    <result column="node_link_virtual" jdbcType="BIT" property="linkVirtual"/>
    <result column="node_permissions" jdbcType="VARCHAR" property="permissions"/>
    <result column="node_nsfw" jdbcType="BIT" property="nsfw"/>
    <result column="node_like" jdbcType="BIT" property="like"/>
    <result column="node_hide" jdbcType="BIT" property="hide"/>
    <result column="node_source_url" jdbcType="VARCHAR" property="sourceUrl"/>
    <result column="node_comment" jdbcType="VARCHAR" property="comment"/>
  </resultMap>
  
  <select id="simpleSearch" resultMap="BaseResultMap">
    select *
    from nodes
    <where>
      <if test="conditions!=null">
        <foreach collection="conditions" item="cond" separator="and">
          ${cond.column} ${cond.oper} ${cond.value}
        </foreach>
      </if>
    </where>
    <if test="sorts!=null">
      order by
      <foreach collection="sorts" item="sort" separator=",">
        ${sort.property} ${sort.direction}
      </foreach>
    </if>
  </select>
</mapper>
